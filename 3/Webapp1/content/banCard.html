<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>银行卡页面</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<style>
			body {
				background-image: url(../images/bg.jpg);
			}
			
			.mui-bar {
				background: linear-gradient(90deg, #734e31, #db9348, #734e31);
				box-shadow: none;
				color: #fef7ea;
			}
			
			.mui-bar h1 {
				color: #fef7ea;
			}
			
			.mui-bar a {
				color: #fef7ea;
			}
			
			.mui-content {
				background: transparent;
			}
			
			.addcard {
				width: 90%;
				padding: 15px 0;
				margin: 30px auto;
				background: #FFEFDE;
				border-radius: 3px;
				text-align: center;
			}
			
			.addcard span {
				font-size: 70px;
				color: #533523;
			}
			
			.addcard .test {
				display: none;
				line-height: 30px;
				color: #533523;
			}
			
			.showApp {
				width: 100%;
				height: 100px;
				margin: 15px 0;
				padding: 15px 10px;
				background: url(../images/cardbj.png) center no-repeat;
			}
			
			.showApp p {
				height: 25px;
				line-break: 25px;
				margin: 0;
				padding: 0;
				padding-left: 80px;
				font-size: 16px;
				color: #FFEFDE;
			}
			.showApp,.addcard{
				display: none;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav mui-action-back">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">银行卡</h1>
		</header>
		<div class="mui-content">
			<div class="addcard" id="addBank">
				<span class="mui-icon mui-icon-plus"></span>
				<div class="test">点击添加银行卡</div>
				<input type="text" hidden="" />
			</div>
			<div class="showApp" id="showApp">
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/app.js"></script>
		<script type="text/javascript">
			(function($, doc) {
				$.init();
				var banksum;
				function addcard(sum) {
					var text;
					for(var i = 0; i < sum.length; i++) {
						text = '<p>' + sum[i].card_username + '</p><p>' + sum[i].bank_name + '</p><p>' + sum[i].card_num + '</p><input id="cardId" value=' + sum[i].id + ' type="text" hidden="" />'
					}
					doc.getElementById('showApp').innerHTML = text;
				}
				window.addEventListener('addbank', function(event) {
					var id = event.detail;
					if(id.judgment === true) {
						var wobj = plus.webview.getWebviewById("banCard");
						wobj.reload(true);
					}
				})
				$.plusReady(function() {
					var settingButton = doc.getElementById('addBank');
					settingButton.addEventListener('tap', function(event) {
						$.openWindow({
							id: 'addBank',
							url: 'addBank.html',
							 extras:{
						        name:'banCard'
						  	},
							show: {
								aniShow: 'pop-in'
							},
							styles: {
								popGesture: 'hide'
							},
							waiting: {
								autoShow: false
							}
						});
					});
				});
				if(JSON.stringify(app.getBankCard()) === '{}') {
					plus.nativeUI.showWaiting();
					app.ajax("User/getUserCard", {}, function(data) {
						plus.nativeUI.closeWaiting();
						if(data.length > 0) {
							app.setBankCard(data);
							document.getElementById('showApp').style.display = 'block'
							doc.getElementById('addBank').style.display = 'none';
							addcard(data);
						} else {
							document.getElementById('showApp').style.display = 'none'
							doc.getElementById('addBank').style.display = 'block';
						}
					})
					return;
				} else {
					doc.getElementById('addBank').style.display = 'none';
					document.getElementById('showApp').style.display = 'block'
					banksum = app.getBankCard();
					addcard(banksum);
				};

			})(mui, document)
		</script>
	</body>

</html>