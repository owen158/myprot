<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/iconfont.css" />
		<link href="css/mui.picker.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/iconfont.css" />
		<link href="css/mui.poppicker.css" rel="stylesheet" />
		<!--<script src="js/vue.js"></script>-->
		<!--<script src="js/vuex.js"></script>
		<script src="js/store.js"></script>-->
		<script>
		</script>
		<style>
			body {
				background-image: url(images/bg.jpg);
				/*background: red;*/
			}
			
			.gameNav {
				background: #734e31;
				margin: 0px 0 10px 0;
			}
			
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item {
				color: #ffefde;
			}
			
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				color: #ffd053;
				border-bottom: 2px solid #ffd053;
			}
			
			.mui-grid-view.mui-grid-9 {
				background: #734E31;
				border-top: none;
				border-left: none;
			}
			
			.mui-table-view.mui-grid-view .mui-table-view-cell .mui-media-body {
				color: #e6c7aa;
			}
			
			.mui-grid-view.mui-grid-9 .mui-table-view-cell.mui-active {
				background: #e5e5e5;
			}
			
			.mui-grid-view.mui-grid-9 .mui-table-view-cell {
				border-bottom: 1px solid #533523;
				border-right: 1px solid #533523;
			}
			
			.addcard {
				margin-top: 30px;
				width: 90%;
				padding: 15px 0;
				margin: 0 auto;
				background: #FFEFDE;
				border-radius: 3px;
				text-align: center;
			}
			
			.addcard span {
				font-size: 70px;
				color: #533523;
			}
			
			.addcard .test {
				line-height: 30px;
				color: #533523;
			}
			
			.mui-input-group {
				background: #ffefde;
			}
			
			.mui-input-row label {
				width: 30%;
				font-size: 14px;
				text-align: right;
			}
			
			.mui-input-row label~input,
			.mui-input-row label~select,
			.mui-input-row label~textarea {
				width: 70%;
			}
			
			button[disabled],
			html input[disabled] {
				background: #e5e5e5;
			}
			
			.mui-input-row {
				margin-top: 10px;
			}
			
			.mui-content {
				background: transparent;
			}
			
			.showApp {
				width: 100%;
				height: 100px;
				margin: 15px 0;
				padding: 15px 10px;
				background: url(images/cardbj.png) center no-repeat;
			}
			
			.showApp p {
				height: 25px;
				line-break: 25px;
				margin: 0;
				padding: 0;
				padding-left: 80px;
				font-size: 16px;
				color: #FFEFDE;
			}
			
			.title {
				padding-left: 15px;
				color: #fef7ea;
				margin-top: 25px;
				text-align: center;
			}
			.item2,.item1{
				display: none;
			}
			/*.mui-input-group,
			.addcard {
				display: none;
			}*/
		</style>
	</head>

	<body>
		<div class="mui-content" id="example">
			<div class="mui-content-padded gameNav">
				<div class="mui-segmented-control mui-segmented-control-inverted mui-segmented-control-primary">
					<a class="mui-control-item mui-active" href="#item1">在线存款</a>
					<a class="mui-control-item" href="#item2">在线取款</a>
					<!--<a class="mui-control-item" href="#item3">银行卡</a>-->
				</div>
			</div>
			<div id="item1" class="mui-control-content mui-active">
				<p id="no_item1" class="title item1">没有支付渠道
					<a href="#" id="chatClient">在线客服</a>
				</p>
				<ul id="off_item1" class="mui-table-view mui-grid-view mui-grid-9 item1">
				</ul>
			</div>
			<div id="item2" class="mui-control-content">
				<div class="item2" id="no_item2">
					<div class="addcard" id="addBank">
						<span class="mui-icon mui-icon-plus"></span>
						<div id="addcard" class="test">点击添加银行卡</div>
					</div>
				</div>
				<div class="item2" id="off_item2">
					<p class="">您目前中心钱包账户余额为 : <span id="userMoney"></span>元 </p>
					<div class="showApp" id="showCard">
					</div>
					<form class="mui-input-group">
						<div class="mui-input-row">
							<label>要求打码量</label>
							<input type="text" disabled="disabled" id="marking_quantity" class="mui-input-clear" placeholder="银行卡号">
						</div>
						<div class="mui-input-row" id="select">
							<label>完成打码量</label>
							<input type="text" disabled="disabled" id="user_quantity" class="mui-input-clear" placeholder="银行卡号">
						</div>
						<div class="mui-input-row">
							<label>提款金额</label>
							<input type="text" id="credit" class="mui-input-clear" placeholder="提款金额 : ￥100 ~  500000">
						</div>
						<div class="mui-input-row">
							<label>取款密码</label>
							<input type="password" id="password" maxlength="4" class="mui-input-clear" placeholder="请输入密码">
						</div>

						<div class="mui-button-row">
							<button id="btn" type="button" class="mui-btn mui-btn-primary">确认</button>
							<!--<button type="button" class="mui-btn mui-btn-danger">取消</button>-->
						</div>
					</form>
				</div>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/mui.picker.js"></script>
		<script src="js/mui.poppicker.js"></script>
		<script src="js/app.js"></script>
		<script type="text/javascript">
			var WithdrawConfig, cardid;
			(function($, doc) {
				$.init();
				//加载网银
				window.addEventListener('deposits', function(event) {
					var id = event.detail;
					if(id.jum === true) {
						doc.getElementById('no_item1').style.display = 'none';
						doc.getElementById('off_item1').style.display = 'block';
						app.setPayment(id.list);
						PaymentInfo(id.list);
					} else {
						doc.getElementById('no_item1').style.display = 'block';
						doc.getElementById('off_item1').style.display = 'none';
					}

				});
				//加载银行卡
				window.addEventListener('addbank', function(event) {
					var id = event.detail;
					if(id.judgment === true){
						document.getElementById('no_item2').style.display = 'none';
						document.getElementById('off_item2').style.display = 'none';
						ObtainCard();
					}
				});
				//支付渠道
				$('.mui-table-view').on('tap', 'a', function(e) {
					var types = this.getAttribute('dataType');
					var dataSrc = this.getAttribute('dataSrc');
					if(types != '44' || types != '66') {
						plus.nativeUI.showWaiting();
						app.ajax('PlatformPay/getPaymentList', {
							type: types
						}, function(data) {
							var list = {
								type: types,
								judgment: '',
								data: ''
							}
							plus.nativeUI.closeWaiting();
							console.log(JSON.stringify(data))
							if(data.status === 'error' || typeof data === 'undefined') {
								list.judgment = false;
								list.data = data.msg;
								list = JSON.stringify(list);
								app.openWindow('content/' + dataSrc, list)
							} else {
								list.judgment = true;
								list.data = data.typeList;
								list = JSON.stringify(list);
								app.openWindow('content/' + dataSrc, list);
							}
						});
					} else {
//						if(types === '44'){
//							
//						}
						app.openWindow('content/' + dataSrc, {});
					}
				})
				
				$('.mui-segmented-control').on('tap', 'a', function(e) {
					var ele = e.target;
					if(this.getAttribute('href') === '#item2') {
						ObtainCard();
					}
				})
				doc.getElementById('btn').addEventListener('tap', function(e) {
					var tk = {
						credit: doc.getElementById('credit').value,
						password: doc.getElementById('password').value,
						cardid: cardid
					};
					//					credit,password,addBank WithdrawConfig
					if(!/^[0-9]+([.]\d{1,2})?$/.test(tk.credit)) {
						plus.nativeUI.toast('请输入金额(例:1.00),最高保留两位小数');
						return;
					}
					if(Number(tk.credit) < 100 || Number(tk.credit) > 500000) {
						plus.nativeUI.toast('请输入金额100 - 500000,最高保留两位小数');
						return;
					}
					if(!/^[0-9]{4}$/.test(tk.password)) {
						plus.nativeUI.toast('请输入提款密码');
						return;
					}
					var btn = ["确定", "取消"],
						texts = '';
					if((Number(WithdrawConfig.marking_quantity) > Number(WithdrawConfig.user_quantity)) && (Number(WithdrawConfig.withdraw_fee) > 0 || Number(WithdrawConfig.withdraw_manage_fee) > 0)) {
						texts = "未完成打码量,提款将收取" + WithdrawConfig.withdrawConfig + "%的费率," + '且今日提款次数过多，提款将收取' + WithdrawConfig.withdraw_fee + '%的手续费和' + WithdrawConfig.withdraw_manage_fee + '元的行政费,是否继续提款？';
						mui.confirm(texts, '系统提示', btn, function(e) {
							if(e.index == 0) {
								WithDraw(tk)
							}
						});
					} else if(Number(WithdrawConfig.marking_quantity) > Number(WithdrawConfig.user_quantity)) {
						texts = "未完成打码量,提款将收取" + WithdrawConfig.withdrawConfig + "%的费率,是否继续提款？";
						mui.confirm(texts, '系统提示', btn, function(e) {
							if(e.index == 0) {
								WithDraw(tk)
							}
						});
					} else if(Number(WithdrawConfig.withdraw_fee) > 0 || Number(WithdrawConfig.withdraw_manage_fee) > 0) {
						texts = "今日提款次数过多，提款将收取" + WithdrawConfig.withdraw_fee + "%的费率+" + WithdrawConfig.withdraw_manage_fee + '的行政费,是否继续提款？';
						mui.confirm(texts, '系统提示', btn, function(e) {
							if(e.index == 0) {
								WithDraw(tk)
							}
						});
					} else {
						WithDraw(tk)
					}
				})
				doc.getElementById('addBank').addEventListener('tap',function(e){
					app.openWindow('content/addBank.html','deposit.html')
				})
				//在线客服
				doc.getElementById('chatClient').addEventListener('tap', function(e) {
					app.Options.id = 'livechatvalue'
					app.Options.url = app.Client;
					app.open(app.Options, '在线客服');
				})
			})(mui, document)

			function Arrdata(obj) {
				let objs = [];
				for(let i = 0; i < obj.length; i++) {
					for(var r= 0;r < app.MBchannel.length;r++){
						if (obj[i] === 21){
							console.log(1)
							continue;
						} 
						if(obj[i] === app.MBchannel[r].sum){
							objs.push(app.MBchannel[r]);
						}
					}
					if(i === obj.length - 1) {
						return objs;
					}
				}
			}
			function ObtainCard() {
				plus.nativeUI.showWaiting();
				app.ajax("User/getUserCard", {}, function(data) {
					plus.nativeUI.closeWaiting();
					if(data.length > 0) {
						document.getElementById('no_item2').style.display = 'none';
						document.getElementById('off_item2').style.display = 'block';
						cardid = data[0].id;
						cardHtml(data);
						Obtain();
					} else {
						document.getElementById('no_item2').style.display = 'block';
						document.getElementById('off_item2').style.display = 'none';
					}
				})
			}
			//			银行卡
			function cardHtml(htmls) {
				document.getElementById('showCard').innerHTML = '';
				var fragment = document.createDocumentFragment();
				htmls.forEach(function(e) {
					var p1 = document.createElement('p');
					p1.textContent = e.card_username;
					var p2 = document.createElement('p');
					p2.textContent = e.card_num;
					var p3 = document.createElement('p');
					p3.textContent = e.bank_name;
					fragment.appendChild(p1);
					fragment.appendChild(p2);
					fragment.appendChild(p3);
				})
				document.getElementById('showCard').appendChild(fragment);
			}
			//提款接口
			function WithDraw(obj) {
				plus.nativeUI.showWaiting();
				app.ajax('User/WithDraw', obj, function(data) {
					plus.nativeUI.closeWaiting();
					console.log(JSON.stringify(data))
					if(data.msg == "success") {
						mui.alert('提款成功', '系统提示', function() {
							document.getElementById('credit').value = ''
							document.getElementById('password').value = ''
							Obtain();
						});
					} else {
						plus.nativeUI.toast(data.msg);
					}
				})
			}
			//					// 获取打码量 //获取钱包余额
			function Obtain() {
				app.ajax('User/selectWithdrawConfig', {}, function(Config) {
					if(Config.status == "success") {
						WithdrawConfig = Config;
						document.getElementById('marking_quantity').value = Config.marking_quantity
						document.getElementById('user_quantity').value = Config.user_quantity
						app.setConfig(Config);
					} else if(Config.status == "faild") {
						document.getElementById('marking_quantity').style.display = 'none';
						document.getElementById('user_quantity').style.display = 'none';
					}
				})
				app.getBalance(function(data) {
					document.getElementById('userMoney').textContent = data
				})
			}
			//			支付渠道页面
			function PaymentInfo(elpage) {

				var Htmls = '';
				var fragment = document.createDocumentFragment();
				document.getElementsByClassName('mui-table-view')[0].innerHTML = '';
				var ele = document.getElementsByClassName('mui-table-view')[0];
				elpage.forEach((e) => {
					var parent = document.createElement('li');
					parent.className = "mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"
					var a_ = document.createElement('a');
					a_.setAttribute('dataType', e.type)
					a_.setAttribute('dataSrc', e.src)
					var span_ = document.createElement('span');
					span_.className = e.icon;
					var One = document.createElement('div');
					One.className = 'mui-media-body';
					One.textContent = e.text;
					var Two = document.createElement('div');
					Two.className = 'mui-media-body';
					Two.textContent = e.title;
					a_.appendChild(span_);
					a_.appendChild(One);
					a_.appendChild(Two);
					parent.appendChild(a_);
					fragment.appendChild(parent);
				})
				ele.appendChild(fragment)
			}
		</script>
	</body>

</html>